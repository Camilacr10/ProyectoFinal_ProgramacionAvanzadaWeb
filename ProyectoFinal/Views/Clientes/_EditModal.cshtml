@model ProyectoFinalBLL.DTOs.ClienteDto

<form id="editForm" asp-action="EditModal" asp-controller="Clientes" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="IdCliente" />

    <div class="mb-3">
        <label asp-for="Identificacion" class="form-label"></label>
        <input asp-for="Identificacion" class="form-control" />
        <span asp-validation-for="Identificacion" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Nombre" class="form-label"></label>
        <input asp-for="Nombre" class="form-control" />
        <span asp-validation-for="Nombre" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Apellido" class="form-label"></label>
        <input asp-for="Apellido" class="form-control" />
        <span asp-validation-for="Apellido" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Telefono" class="form-label"></label>
        <input asp-for="Telefono" class="form-control" />
        <span asp-validation-for="Telefono" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Email" class="form-label"></label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Direccion" class="form-label"></label>
        <input asp-for="Direccion" class="form-control" />
        <span asp-validation-for="Direccion" class="text-danger"></span>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    </div>
</form>

<!-- Script para SweetAlert -->
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("editForm");

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const formData = new FormData(form);
                const actionUrl = form.getAttribute("action");

                try {
                    const response = await fetch(actionUrl, {
                        method: "POST",
                        body: formData,
                    });

                    if (response.ok) {
                        Swal.fire({
                            icon: "success",
                            title: "Cambios guardados",
                            text: "El cliente se actualizó correctamente.",
                            confirmButtonText: "Aceptar",
                            confirmButtonColor: "#3085d6"
                        }).then(() => {
                            // Si usas modal Bootstrap, ciérralo
                            const modal = bootstrap.Modal.getInstance(document.querySelector(".modal"));
                            modal.hide();

                            // Recargar la página o actualizar tabla
                            location.reload();
                        });
                    } else {
                        Swal.fire({
                            icon: "error",
                            title: "Error al guardar",
                            text: "No se pudieron guardar los cambios. Intenta de nuevo.",
                            confirmButtonText: "Aceptar"
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: "error",
                        title: "Error de conexión",
                        text: "Ocurrió un problema al enviar la solicitud.",
                        confirmButtonText: "Aceptar"
                    });
                }
            });
        });
    </script>
}
